# Описание решения


## Хранилище данных
Сервис osago-aggregator будет взаимодействовать с базой данных osago-aggregator-db. База данных будет хранить информацию по заявкам на ОСАГО в виде событий по патерну Event Sourcing.


## Взаимодействие с core-app

Взаимодействие с core-app происходит асинхронно через поток событий. После создания/обновления пользователем данных заявки - соответствующее событие отправляется в osago-aggregator через поток задач. 

Получив заявку - osago-aggregator отправляет запрос в страховые компании на формирование предложения по ней.

Для формирования заявки в страховую компанию нужно добавить формирование материального представления данных в виде объекта заявки.

Чтобы не генерировать слишком много запросов - нужно установить настраеваемый rate-limmiter для запросов в страховые компании. Запросы могут отарвляться в компанию не чаще чем раз в некоторый интервал времени. При каждой отправке запроса используется актуальное состояние заявки с учетом всех ее правок на текущий момент.

Если страховые компании имеют возможность - заявки можно отправлять к ним батчами. Если нет - то можно поштучно. 

В случае сбоя соединения происходит фиксированное количество повторов с учетом ограничений на соединение. Ошибки после череды повторов фиксируются как события для core-app.

Получив ответ от сраховой компании создается событие с полученым предложением которое отправляется в core-app.

При принятии предложения создается событие отправляющееся в osago-aggregator.

Когда osago-aggregator получит ответ - будет сформировано событие для core-app.


## Отображение у пользователя

В интерфейсе клиента оображается таблица с предложениями от страховых компаний, которая заполняется по мере получения ответов через асинхронную систему. Для обновления информации в веб-интерфейсе можно использовать веб-сокеты или long-polling.